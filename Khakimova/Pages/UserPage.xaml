<Page x:Class="Khakimova.Pages.UserPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="clr-namespace:Khakimova.Pages"
      Title="User Page"
      Loaded="Page_Loaded" Height="319" Width="1060">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель фильтров - компактная версия -->
        <Border Grid.Row="0" Background="#F5F5F5" Padding="8" Margin="5,10,5,5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">

                <!-- Поиск по ФИО -->
                <StackPanel Orientation="Vertical" Margin="5,0" Width="150">
                    <TextBlock Text="Поиск по ФИО:" FontSize="11" Foreground="Gray" Margin="0,0,0,2" Height="20" Width="122"/>
                    <TextBox x:Name="FioFilterTextBox" 
                             TextChanged="FioFilterTextBox_TextChanged"
                             ToolTip="Введите ФИО для поиска пользователей"
                             FontSize="12" Height="25" Width="118"/>
                </StackPanel>

                <!-- Сортировка -->
                <StackPanel Orientation="Vertical" Margin="10,0" Width="130">
                    <TextBlock Text="Сортировка:" FontSize="11" Foreground="Gray" Margin="0,0,0,2"/>
                    <ComboBox x:Name="SortComboBox" 
                              SelectionChanged="SortComboBox_SelectionChanged"
                              SelectedIndex="0" 
                              FontSize="12" Height="25">
                        <ComboBoxItem Content="А-Я"/>
                        <ComboBoxItem Content="Я-А"/>
                    </ComboBox>
                </StackPanel>

                <!-- Фильтр по роли -->
                <StackPanel Orientation="Vertical" Margin="10,0" VerticalAlignment="Center">
                    <CheckBox x:Name="OnlyAdminCheckBox" 
                              Content="Только админы" 
                              Checked="OnlyAdminCheckBox_Checked" 
                              Unchecked="OnlyAdminCheckBox_Unchecked"
                              FontSize="11"
                              ToolTip="Показать только администраторов"/>
                </StackPanel>

                <!-- Кнопки -->
                <StackPanel Orientation="Horizontal" Margin="15,0"/>

            </StackPanel>
        </Border>

        <!-- Список пользователей -->
        <ListView Name="ListUser" 
                  Grid.Row="1" 
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  Margin="5,5,5,0"
                  MouseDoubleClick="ListUser_MouseDoubleClick">
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>

            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="LightGray" 
                            BorderThickness="1" 
                            CornerRadius="5" 
                            Margin="3" 
                            Padding="3"
                            Background="White"
                            Width="180"
                            Height="280">
                        <Grid Margin="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- ФИО -->
                            <TextBlock Grid.Row="0" 
                                       Text="{Binding FIO}" 
                                       FontSize="12" 
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap" 
                                       TextAlignment="Center"
                                       MaxHeight="35"
                                       Margin="2"/>

                            <!-- Фотография -->
                            <Border Grid.Row="1" 
                                    BorderBrush="#E0E0E0" 
                                    BorderThickness="1" 
                                    Margin="5"
                                    Background="#F8F8F8"
                                    Height="150">
                                <Image Stretch="Uniform" 
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center">
                                    <Image.Source>
                                        <Binding Path="PhotoData">
                                            <Binding.Converter>
                                                <local:ByteArrayToImageConverter/>
                                            </Binding.Converter>
                                        </Binding>
                                    </Image.Source>
                                </Image>
                            </Border>

                            <!-- Роль -->
                            <Border Grid.Row="2" 
                                    Background="{Binding Role, Converter={x:Static local:RoleToColorConverter.Instance}}"
                                    CornerRadius="3" 
                                    Margin="5,2"
                                    Padding="3,1">
                                <TextBlock Text="{Binding Role}" 
                                           FontSize="11" 
                                           FontWeight="Bold"
                                           Foreground="White"
                                           TextAlignment="Center"/>
                            </Border>

                            <!-- Логин -->
                            <TextBlock Grid.Row="3" 
                                       Text="{Binding Login}" 
                                       FontSize="10" 
                                       Foreground="Gray"
                                       TextAlignment="Center"
                                       Margin="2"/>

                            <!-- ID -->
                            <TextBlock Grid.Row="4" 
                                       Text="{Binding ID, StringFormat='ID: {0}'}" 
                                       FontSize="9" 
                                       Foreground="Silver"
                                       TextAlignment="Center"
                                       Margin="2"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</Page>